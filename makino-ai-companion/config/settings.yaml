# =============================================================================
# 牧野生保塾 AI伴走システム - プロジェクト設定
# =============================================================================
# 本ファイルにプロジェクト全体の設定を集約する。
# 環境変数は ${ENV_VAR} 形式で参照可能。
# =============================================================================

# --- プロジェクト基本情報 ---
project:
  name: "牧野生保塾 AI伴走システム"
  version: "0.2.0"
  duration_months: 12
  start_date: null  # プロジェクト開始日を設定
  confidential: true

# --- Claude API 設定（メインLLM）---
claude:
  api_key: ${ANTHROPIC_API_KEY}
  model: "claude-sonnet-4-5-20250929"
  max_tokens: 4096
  # Pattern別のパラメータ調整
  pattern_overrides:
    pattern_1:
      temperature: 0.5  # 正確性重視
    pattern_2:
      temperature: 0.5  # 専門性重視
    pattern_3:
      temperature: 0.3  # 数値の正確性を最大限重視
    pattern_4:
      temperature: 0.8  # 自然な会話重視

# --- RAG（検索拡張生成）設定 ---
rag:
  # GitHub上のナレッジベースディレクトリ
  knowledge_dir: "knowledge"
  # チャンク分割設定
  chunk_size: 500
  chunk_overlap: 50
  top_k: 5  # 検索時の上位取得件数
  similarity_threshold: 0.7  # 類似度の下限
  # ベクトルストア（ローカルFAISS）
  vector_store:
    type: "faiss"
    index_path: "data/vector_index"
    rebuild_on_start: false

# --- ナレッジベース設定（GitHub管理）---
knowledge_base:
  # GitHubリポジトリ内のナレッジ格納パス
  base_path: "knowledge"
  # パターン別ナレッジディレクトリ
  # 各パターンは専用ディレクトリ + shared を検索する
  pattern_dirs:
    - dir: "general"
      pattern_id: 1
      description: "生保全般 Q&A"
      priority: "high"
    - dir: "doctor"
      pattern_id: 2
      description: "ドクターマーケット特化"
      priority: "high"
    - dir: "corporate"
      pattern_id: 3
      description: "法人保険特化"
      priority: "high"
    - dir: "mentoring"
      pattern_id: 4
      description: "励まし・メンタリング"
      priority: "high"
    - dir: "shared"
      pattern_id: null  # 全パターン共通
      description: "全パターン共通ナレッジ（牧野語録等）"
      priority: "high"

# --- データベース設定（会話ログ蓄積）---
database:
  # SQLite（リアルタイム蓄積）
  sqlite:
    path: "data/conversations.db"
    # 定期エクスポート設定（GitHub監査用）
    export:
      enabled: true
      schedule: "weekly"  # daily / weekly / monthly
      export_dir: "logs/exports"
      format: "csv"  # csv / json

# --- FastAPI サーバー設定 ---
server:
  host: "0.0.0.0"
  port: 8000
  debug: false
  # CORS設定（チャットウィジェット埋め込み用）
  cors:
    allow_origins:
      - "http://localhost:3000"
      - ${ALLOWED_ORIGIN}  # 本番ドメインを設定
    allow_methods: ["GET", "POST"]
    allow_headers: ["*"]

# --- 認証設定（Google OAuth2）---
auth:
  google_client_id: ${GOOGLE_CLIENT_ID}
  google_client_secret: ${GOOGLE_CLIENT_SECRET}
  # 管理者メールアドレス（KPIダッシュボード等へのアクセス許可）
  admin_emails:
    - ${ADMIN_EMAIL}

# --- エスカレーション設定 ---
escalation:
  confidence_threshold: 0.5  # この値以下でエスカレーション
  notification:
    method: "email"  # email / slack / line
    recipients:
      - ${ESCALATION_EMAIL_PRIMARY}
  # エスカレーション対象カテゴリ
  mandatory_categories:
    - "コンプライアンス関連"
    - "個別顧客の契約内容"
    - "具体的な保険料試算"
    - "税務の最終判断"

# --- 人格トレース設定 ---
persona:
  name: "牧野 克彦"
  role: "生命保険営業のカリスマ"
  # 基本性格パラメータ
  traits:
    warmth: 0.7        # 温かさ（0: 事務的 〜 1: 非常に温かい）
    strictness: 0.6    # 厳しさ（0: 甘い 〜 1: 非常に厳しい）
    professionalism: 0.9  # プロ意識（0: カジュアル 〜 1: 非常にプロフェッショナル）
    empathy: 0.8       # 共感力（0: 論理のみ 〜 1: 感情重視）

  # NGワード
  ng_words:
    - "ネットスラング全般"
    - "他社批判"
    - "不確実な断定表現"
    - "コンプライアンス違反となる発言"

  # 象徴的フレーズ
  signature_phrases:
    - "誰にでもできることを、だれにも負けないほどやる"
    - "過去と他人は変えられないが、未来と自分は変えられる"

# --- KPI目標値 ---
kpi:
  answer_accuracy: 0.80
  user_satisfaction: 0.85
  average_confidence: 0.70
  new_question_rate: 0.20
  answer_success_rate: 0.80
  unanswerable_rate: 0.20

# --- モニタリング設定 ---
monitoring:
  daily:
    - "質問総数"
    - "パターン別利用頻度"
    - "回答成功率"
    - "エスカレーション発生件数"
  weekly:
    - "ユーザー満足度集計"
    - "新規質問パターン抽出"
    - "確信度低下回答の精査"
  monthly:
    - "ナレッジベース更新要否判断"
    - "プロンプトチューニング"
    - "運用コスト予実管理"

# --- ナレッジパイプライン設定 ---
pipeline:
  # 入力ディレクトリ
  intake_dir: "intake"
  # 並列実行数（Claude API同時呼び出し数）
  max_concurrent: 5
  # Whisperモデルサイズ (tiny/base/small/medium/large)
  whisper_model: "base"
  # Pass3 品質検証を有効にする
  verification_enabled: true
  # 手動レビュー判定の閾値
  review_thresholds:
    confidence_min: 0.6   # これ未満は手動レビュー対象
    quality_min: 0.6      # これ未満は手動レビュー対象
  # レポート出力先
  report_dir: "logs/pipeline"

# --- 開発フェーズ管理 ---
phases:
  phase_1:
    name: "ヒアリング・要件定義"
    months: [1, 2]
    status: "pending"
  phase_2:
    name: "データ収集・整理・ラベリング"
    months: [3, 4]
    status: "pending"
  phase_3:
    name: "PoC開発・技術検証"
    months: [5, 6]
    status: "pending"
  phase_4:
    name: "MVP開発 (Pattern 1)"
    months: [7, 8]
    status: "pending"
  phase_5:
    name: "パターン展開 (Pattern 2-4)"
    months: [9, 10]
    status: "pending"
  phase_6:
    name: "本番運用・保守体制構築"
    months: [11, 12]
    status: "pending"
